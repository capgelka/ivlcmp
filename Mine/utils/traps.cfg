#textdomain wesnoth-smm

# #define FIRE_TRAP DAMAGE

#     [event]
#         first_time_only=no
#         name=moveto

#         [filter]
#             [filter_location]
#                 terrain=*^Tpf*
#             [/filter_location]
#         [/filter]
#         [sound]
#             name=explosion.ogg
#         [/sound]
#         [item]   
# 	    x=$x1
#             y=$y1
#             halo=projectiles/fire-burst-small-1.png:50,projectiles/fire-burst-small-2.png:50,projectiles/fire-burst-small-3.png:50,projectiles/fire-burst-small-4.png:50,projectiles/fire-burst-small-5.png:50,projectiles/fire-burst-small-6.png:50,projectiles/fire-burst-small-7.png:50,projectiles/fire-burst-small-8.png:50,misc/blank-hex.png:1000000
#         [/item]

#         [harm_unit]
#             [filter]
# 	        x=$x1
#                 y=$y1
#             [/filter]
#             amount={DAMAGE}
#             damage_type=fire
#             animate=yes
#             fire_event=yes
#             slowed=yes
#             experiance=yes
#         [/harm_unit]
#         [terrain]
#             x=$x1
#             y=$y1
#             layer=overlay
#             terrain=^
#         [/terrain]
#     [/event]

# #enddef

# #define MAKE_FIRE_TRAP X Y
#     [terrain]
#         x={X}
#         y={Y}
#         layer=overlay
#         terrain=^Fds
#     [/terrain]
# #enddef

# #define MAKE_POISON_TRAP X Y
#     [terrain]
#         x={X}
#         y={Y}
#         layer=overlay
#         terrain=^Tpp
#     [/terrain]
# #enddef

# #define CURRENT_SIDE_COLD
#        {DEBUG_MSG "side $side_number"}
#     [store_si]
#         [filter_side]
#             side=$side_number
#         [/filter_side]
#         variable=gold
#     [/store_gold]
#     {DEBUG_MSG "gold $gold[$side_number]"}

# #enddef

#define UPDATE_SIDE_INFO
      [store_side]
            side=$side_number
            variable=current_side
      [/store_side]
#enddef 

#define MAKE_FOREST X Y
    [terrain]
        x={X}
        y={Y}
        layer=overlay
        terrain=^Fds
    [/terrain]
#enddef

#define DESTROY X Y
    [terrain]
        x={X}
        y={Y}
        layer=overlay
        terrain=^Dr
    [/terrain]
#enddef

#define BUILD_CAMP X Y
    [terrain]
        x={X}
        y={Y}
        layer=base
        terrain=Cud
    [/terrain]
      [set_variable]
                    name=unit.status.use_trap
                    value=yes
                [/set_variable]

                [set_variable]
                    name=gold_bonus
                    value=-15
                [/set_variable]

		[unstore_unit]
                    variable=unit
		    {CLEAR_VARIABLE unit}
                [/unstore_unit]
                [harm_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    amount=0
                    animate=yes
                    slowed=yes
                [/harm_unit]
                [gold]
                    amount=$gold_bonus
                    side=$side_number
                [/gold]
                [sound]
                    name=gold.ogg
                [/sound]
                 {UPDATE_SIDE_INFO}
#enddef

#define BUILD_KEEP X Y
    [terrain]
        x={X}
        y={Y}
        layer=base
        terrain=Kud
    [/terrain]

      [set_variable]
                    name=unit.status.use_trap
                    value=yes
                [/set_variable]

                [set_variable]
                    name=gold_bonus
                    value=-15
                [/set_variable]

		[unstore_unit]
                    variable=unit
		    {CLEAR_VARIABLE unit}
                [/unstore_unit]
                [harm_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    amount=0
                    animate=yes
                    slowed=yes
                [/harm_unit]
                [gold]
                    amount=$gold_bonus
                    side=$side_number
                [/gold]
                [sound]
                    name=gold.ogg
                [/sound]
                {UPDATE_SIDE_INFO}
#enddef

#define MAKE_PENTOGRAM X Y
    [terrain]
        x={X}
        y={Y}
        layer=overlay
        terrain=^Ptm
    [/terrain]

    [time_area]
        x=$x1,$x1+1,$x1-1
        y=$y1,$y1}+1,$y1-1
        [time]
            id=dark_aura
            name= _ "dark aura"
            image=misc/time-schedules/tod-schedule-24hrs.png~CROP(0,195,125,39)
            lawful_bonus=-25
            red=-25
            green=-45
            blue=-15
        [/time]
    [/time_area]

      [set_variable]
                    name=unit.status.use_trap
                    value=yes
                [/set_variable]

		[unstore_unit]
                    variable=unit
		    {CLEAR_VARIABLE unit}
                [/unstore_unit]
                [harm_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    amount=0
                    animate=yes
                    slowed=yes
                [/harm_unit]
                {UPDATE_SIDE_INFO}
#enddef

#define BUILD_VILLAGE X Y
    [terrain]
        x={X}
        y={Y}
        layer=overlay
        terrain=^Vh
    [/terrain]

      [set_variable]
                    name=unit.status.use_trap
                    value=yes
                [/set_variable]

                [set_variable]
                    name=gold_bonus
                    value=-15
                [/set_variable]

		[unstore_unit]
                    variable=unit
		    {CLEAR_VARIABLE unit}
                [/unstore_unit]
                [harm_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    amount=0
                    animate=yes
                    slowed=yes
                [/harm_unit]
                [gold]
                    amount=$gold_bonus
                    side=$side_number
                [/gold]
                [sound]
                    name=gold.ogg
                [/sound]
                [capture_village]
                        x=$x1
                        y=$y1
                    side=$side_number
                [/capture_village]
                {UPDATE_SIDE_INFO}
#enddef

#define ABILS
    [event]
        name=side_turn

        first_time_only=no

[time_area]
       remove=yes
    [/time_area]

        [time_area]
        # [filter_location]
            terrain=*^Ptm
            # [filter_adjacent_location]
            #     count=6
            # [/filter_adjacent_location]
        # [/filter_location]
        [time]
            id=dark_aura
            name= _ "dark aura"
            image=misc/time-schedules/tod-schedule-24hrs.png~CROP(0,195,125,39)
            lawful_bonus=-25
            red=-25
            green=-45
            blue=-15
        [/time]
    [/time_area]
# [time_area]
#         # [filter_location]
#             terrain=!, *^Ptm
     
       
#     [/time_area]


        # {CURRENT_SIDE_COLD}
        [store_side]
            side=$side_number
            variable=current_side
        [/store_side]
        # {DEBUG_MSG "gold $current_side.gold"}
        ################ elves
        [set_menu_item]
            [show_if]
                [have_unit] 
                    side=$side_number       
                    race=wose
                    x=$x1
                    y=$y1
	            [not]
                        [filter_wml]
                            [status]
                                use_trap=yes
                            [/status]
                        [/filter_wml]
                    [/not]    
                [/have_unit]
            [/show_if]
            id=make_forest
            description=_ "make forest"

            [command]
		[store_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    variable=unit
		    kill=yes
                [/store_unit]
                {VARIABLE trapX $x1}
                {VARIABLE trapY $y1}
                {MAKE_FOREST $trapX $trapY}


		[set_variable]
                    name=unit.status.use_trap
                    value=yes
                [/set_variable]
		[unstore_unit]
                    variable=unit
		    {CLEAR_VARIABLE unit}
                [/unstore_unit]
                [harm_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    amount=0
                    animate=yes
                    slowed=yes
                    poisoned=yes
                [/harm_unit]
            [/command]

        [/set_menu_item]

        ################# orcs

        [set_menu_item]
            [show_if]
                [have_unit] 
                    side=$side_number       
                    race=wolf
                    x=$x1
                    y=$y1
		    [not]
		        [filter_wml]
		            [status]
		                use_trap=yes
		            [/status]
		        [/filter_wml]
		    [/not]
                    [filter_location]
                    x=$x1
                    y=$y1
                    terrain=*^V*
                    [/filter_location]      
                [/have_unit]
            [/show_if]
            id=destroy_village
            description=_ "destroy village"



            [command]
		[store_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    variable=unit
                [/store_unit]
                {VARIABLE trapX $x1}
                {VARIABLE trapY $y1}
                {DESTROY $trapX $trapY}


                [set_variable]
                    name=unit.status.use_trap
                    value=yes
                [/set_variable]

                [set_variable]
                    name=gold_bonus
                    rand=10..20
                [/set_variable]

		[unstore_unit]
                    variable=unit
		    {CLEAR_VARIABLE unit}
                [/unstore_unit]
                [harm_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    amount=0
                    animate=yes
                    slowed=yes
                [/harm_unit]
                [gold]
                    amount=$gold_bonus
                    side=$side_number
                [/gold]
                [sound]
                    name=gold.ogg
                [/sound]
            [/command]

        [/set_menu_item]

        ############## dwarves

        [set_menu_item]
            [show_if]
                    [have_unit] 
                        side=$side_number       
                        type=Dwarvish Fighter,Dwarvish Steelclad,Dwarvish Lord
                        x=$x1
                        y=$y1
		        [not]
		            [filter_wml]
		                [status]
		                    use_trap=yes
		                [/status]
		            [/filter_wml]
		        [/not]
                        [filter_location]
                            terrain=!, Kud*^*
                            x=$x1
                            y=$y1
                        [/filter_location]
                    [/have_unit]
                   
                    # [filter]
                            [variable]
                                name=current_side.gold
                                greater_than=15
                            [/variable]
                    #     [/filter]
            [/show_if]
            id=build_camp
            description=_ "build_camp"



            [command]
                {UPDATE_SIDE_INFO}
		[store_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    variable=unit
                [/store_unit]
                {VARIABLE trapX $x1}
                {VARIABLE trapY $y1}
                [if]
                    [variable]
                        name=current_side.gold
                        greater_than=15
                    [/variable]
                    [then]
                          [if]
                              [have_location]
                                  terrain=C*^*
                                  x=$trapX
                                  y=$trapY
                              [/have_location]
                              [then]
                                  {BUILD_KEEP $trapX $trapY}
                        
                              [/then]
                              [else]
                                  {BUILD_CAMP $trapX $trapY}
                              [/else]
                          [/if] 
                      [/then]
                      [else]
                          [message]
                              side=$side_number
                              speaker=unit
                              message= _ "We need at least 15 gold to build it my Lord"
                          [/message]
                      [/else]
                [/if]
              

            [/command]

        [/set_menu_item]
        ################ humans


        [set_menu_item]
            [show_if]
                    [have_unit] 
                        side=$side_number       
                        type=Peasant
                        x=$x1
                        y=$y1
		        [not]
		            [filter_wml]
		                [status]
		                    use_trap=yes
		                [/status]
		            [/filter_wml]
		        [/not]
                        [filter_location]
                            terrain=!, K*^*, C*^*, *^V*
                            x=$x1
                            y=$y1
                        [/filter_location]
                    [/have_unit]
                   
                    # [filter]
                            [variable]
                                name=current_side.gold
                                greater_than=15
                            [/variable]
                    #     [/filter]
            [/show_if]
            id=build_village
            description=_ "build_village"



            [command]
                {UPDATE_SIDE_INFO}
		[store_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    variable=unit
                [/store_unit]
                {VARIABLE trapX $x1}
                {VARIABLE trapY $y1}
                [if]
                    [variable]
                        name=current_side.gold
                        greater_than=15
                    [/variable]
                    [then]
                         
                        {BUILD_VILLAGE $trapX $trapY}

                      [/then]
                      [else]
                          [message]
                              side=$side_number
                              speaker=unit
                              message= _ "We need at least 15 gold to build it my Lord"
                          [/message]
                      [/else]
                [/if]
              

            [/command]

        [/set_menu_item]

 ################ undead


        [set_menu_item]
            [show_if]
                    [have_unit] 
                        side=$side_number       
                        type=Dark Adept, Dark Sorcerer
                        x=$x1
                        y=$y1
		        [not]
		            [filter_wml]
		                [status]
		                    use_trap=yes
		                [/status]
		            [/filter_wml]
		        [/not]
                        [filter_location]
                            terrain=!, *^V*
                            x=$x1
                            y=$y1
                        [/filter_location]
                    [/have_unit]
                   
                    # [filter]
                            # [variable]
                            #     name=current_side.gold
                            #     greater_than=15
                            # [/variable]
                    #     [/filter]
            [/show_if]
            id=make_pentogram
            description= _ "make pentogram"



            [command]
                {UPDATE_SIDE_INFO}
		[store_unit]
                    [filter]
                        x=$x1
                        y=$y1
                    [/filter]
                    variable=unit
                [/store_unit]
                {VARIABLE trapX $x1}
                {VARIABLE trapY $y1}
                         
                {MAKE_PENTOGRAM $trapX $trapY}

                  
              

            [/command]

        [/set_menu_item]

    # [/event]




    # [event]
    #     name=side turn
    #     first_time_only=no

    #     first_time_only=no

        [store_unit]
            [filter]
                [filter_wml]
                    [status]
                        use_trap=yes
                    [/status]
                [/filter_wml]
            [/filter]

            kill=yes
            variable=this_side_workers
        [/store_unit]

        {FOREACH this_side_workers i}
            [clear_variable]
                name=this_side_workers[$i].status.use_trap
            [/clear_variable]

            [unstore_unit]
                variable=this_side_workers[$i]
            [/unstore_unit]
            {NEXT i}

        [clear_variable]
            name=this_side_workers
        [/clear_variable]

    [/event]
#enddef



#define PENTOGRAM DAMAGE

    

    [event]
        first_time_only=no
        name=moveto
        [filter]
            [filter_location]
                terrain=*^Ptm*
            [/filter_location]           
        [/filter]

        [if]
            [variable]
                name=unit.hitpoints
                less_than_equal_to={DAMAGE}
            [/variable]
            [then]
                [set_variable]
                    name=death
                    value=1
                [/set_variable]
            [/then]
            [else]
                [set_variable]
                    name=death
                    value=0
                [/set_variable]
            [/else]
        [/if]

        [set_variable]
            name=unit.hitpoints
            add=-{DAMAGE}
        [/set_variable]


        [harm_unit]
            [filter]
	        x=$x1
                y=$y1
            [/filter]
            amount={DAMAGE}
            damage_type=arcane
            animate=yes
            fire_event=yes
            poisoned=yes
            experiance=yes
        [/harm_unit]

        [if]
            [variable]
                name=death
                equals=1
            [/variable]
            [then]
                {GENERIC_UNIT 5 "Ghost" $x1 $y1}
            [/then]
        [/if]

        [terrain]
            x=$x1
            y=$y1
            layer=overlay
            terrain=^
        [/terrain]
    [/event]    

     [event]
        first_time_only=no
        name=death
        # [filter]
            # [filter_location]
                terrain=*^Ptm
            # [/filter_location] 
            
        # [/filter]

        {GENERIC_UNIT 5 "Ghost" $x1 $y1}
        [terrain]
            x=$x1
            y=$y1
            layer=overlay
            terrain=^
        [/terrain]
    [/event] 
#enddef

# #define USE DAMAGE X Y

#     [harm_unit]
#         [filter]
#             x={X}
#             y={Y}
#         [/filter]
#         amount={DAMAGE}
#         animate=yes
#         # slowed=yes
#         poisoned=yes
#     [/harm_unit]

# #enddef
